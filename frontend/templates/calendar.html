{% extends "base.html" %}

{% block title %}Calendar{% endblock %}

{% block content %}
<h1>Study Session Calendar</h1>
<div class="calendar">
    <div class="calendar-header">
        <a href="{{ url_for('calendar', month=previous_month, year=previous_year) }}" class="nav-button">Previous</a>
        <h2>{{ current_month_name }} {{ current_year }}</h2>
        <a href="{{ url_for('calendar', month=next_month, year=next_year) }}" class="nav-button">Next</a>
    </div>
    <div class="calendar-grid">
        <!-- Render day names -->
        {% for day in ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"] %}
        <div class="day">{{ day }}</div>
        {% endfor %}

        <!-- Render empty cells for padding -->
        {% for _ in range(start_day_of_week) %}
        <div class="date empty"></div>
        {% endfor %}

        <!-- Render session dates -->
        {% for day in range(1, days_in_month + 1) %}
        <div class="date">
            <strong>{{ day }}</strong>
            {% for session in sessions %}
            {% if session.date.day == day %}
            <p>{{ session.course }} at {{ session.time }} {{ session.timezone }}</p>
            <!-- Add Edit link inside session details -->
            <a href="{{ url_for('edit_session', session_id=session['_id']) }}">Edit</a>
            {% endif %}
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</div>

<!-- Session management section -->
{% for session in sessions %}
<div>
    <p>{{ session.course }} at {{ session.time }} {{ session.timezone }}</p>
    {% if session["participants"] and session["user"] in session["participants"] %}
    <form method="POST" action="{{ url_for('leave_session', session_id=session['_id']) }}">
        <button type="submit">Leave Session</button>
    </form>
    {% else %}
    <form method="POST" action="{{ url_for('join_session', session_id=session['_id']) }}">
        <button type="submit">Join Session</button>
    </form>
    {% endif %}
    <!-- Add Edit link for session management -->
    <a href="{{ url_for('edit_session', session_id=session['_id']) }}">Edit</a>
</div>
{% endfor %}

{% endblock %}